# ESP32 TCP测试服务器

这是一个用于测试ESP32设备TCP通信的Python服务器程序。该服务器可以接收来自ESP32设备的TCP连接，并提供交互式命令行接口来发送命令和查看接收到的数据。

## 功能特点

- 支持多客户端同时连接
- 可以接收并显示来自ESP32设备的文本和二进制数据
- 提供交互式命令行界面，可以向特定客户端发送消息
- 支持广播功能，可同时向所有连接的设备发送消息
- 自动将接收到的数据显示为文本或十六进制格式

## 系统要求

- Python 3.6+
- 不需要额外的第三方库（仅使用Python标准库）

## 使用方法

### 启动服务器

默认情况下，服务器监听所有网络接口的8080端口：

```bash
python3 tcp_server_test.py
```

您也可以指定自定义的主机地址和端口：

```bash
python3 tcp_server_test.py --host 192.168.1.100 --port 9000
```

### 命令行指令

服务器启动后，将显示命令行界面，支持以下指令：

- `list` - 列出所有已连接的客户端
- `send <索引> <消息>` - 向指定索引的客户端发送消息
- `broadcast <消息>` - 向所有连接的客户端广播消息
- `help` - 显示帮助信息
- `exit` - 退出服务器

示例：
```
TCP服务器> list
连接的客户端:
  [0] 192.168.1.105:52134

TCP服务器> send 0 Hello ESP32
消息已发送到 192.168.1.105:52134

TCP服务器> broadcast 测试广播消息
广播消息已发送到 1/1 个客户端
```

## 在ESP32上连接到服务器

要让ESP32设备连接到该测试服务器，您需要在ESP32代码中配置正确的服务器IP地址和端口。根据项目中的网络模块，可以类似这样使用：

```cpp
// 假设WiFi已连接...
net_module net;
if (net.connect_tcp("192.168.1.100", 8080)) {
    // 连接成功，可以发送数据
    std::vector<uint8_t> data = {0x48, 0x65, 0x6C, 0x6C, 0x6F}; // "Hello"
    net.send(data);
}
```

## 调试提示

1. 确保ESP32设备和运行服务器的计算机在同一网络中
2. 检查防火墙设置，确保不会阻止TCP通信
3. 如果连接不上，尝试使用更简单的测试工具（如netcat）来验证服务器是否正常工作：
   ```
   nc 127.0.0.1 8080
   ``` 